<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>✨记录和沫沫的小网站✨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: '微软雅黑', sans-serif;
        }

        body {
            min-height: 100vh;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            transition: background-image 1s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #000;
            overflow: hidden;
        }

        /* 视频背景容器 */
        #video-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
            opacity: 0;
            transition: opacity 1s ease;
        }

        #background-video {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 100%;
            min-height: 100%;
            object-fit: cover;
        }

        /* 顶部导航栏 */
        .nav-bar {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            color: white;
            font-size: 24px;
            cursor: pointer;
            background-color: rgba(0,0,0,0.3);
            padding: 8px 12px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background-color: rgba(0,0,0,0.6);
            transform: scale(1.1);
        }

        /* 主内容区 */
        .main-content {
            text-align: center;
            color: white;
            padding: 50px;
            z-index: 100;
            animation: fadeIn 1.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .title {
            font-size: 48px;
            color: #ff6b6b;
            margin-bottom: 20px;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .countdown {
            font-size: 36px;
            color: #4ecdc4;
            margin: 20px 0;
            text-shadow: 1px 1px 5px rgba(0,0,0,0.5);
        }

        .subtitle {
            font-size: 24px;
            color: #f7fff7;
            margin-bottom: 50px;
            line-height: 1.6;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* 音乐播放器样式 */
        #music-player {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background-color: rgba(0,0,0,0.5);
            padding: 10px 20px;
            border-radius: 30px;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        #music-toggle {
            cursor: pointer;
            font-size: 20px;
        }

        #music-progress {
            flex-grow: 1;
            height: 4px;
            background-color: rgba(255,255,255,0.2);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
            max-width: 200px;
        }

        #progress-bar {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background-color: #ff6b6b;
            border-radius: 2px;
            width: 0%;
        }

        #time-display {
            font-size: 14px;
            min-width: 60px;
            text-align: center;
        }

        /* 加载提示 */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            transition: opacity 0.5s ease;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid #ff6b6b;
            border-bottom-color: transparent;
            border-radius: 50%;
            animation: rotation 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 视频/图片切换按钮 */
        #bg-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background-color: rgba(0,0,0,0.5);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        #bg-toggle:hover {
            background-color: rgba(0,0,0,0.8);
        }

        /* 视频控制按钮 */
        #video-control {
            position: fixed;
            bottom: 20px;
            right: 160px;
            z-index: 1000;
            background-color: rgba(0,0,0,0.5);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        #video-control:hover {
            background-color: rgba(0,0,0,0.8);
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: modalIn 0.3s ease;
        }
        
        @keyframes modalIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .close-modal {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
            color: #666;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .diary-entry {
            margin-bottom: 20px;
            padding: 15px;
            border-left: 3px solid #ff6b6b;
            background-color: #f9f9f9;
            border-radius: 5px;
            position: relative;
        }
        
        .diary-date {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 5px;
        }
        
        .diary-content {
            line-height: 1.6;
        }
        
        .diary-controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        
        .diary-controls button {
            flex-grow: 1;
            padding: 8px 15px;
            background-color: #ff6b6b;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .diary-controls button:hover {
            background-color: #e65252;
        }
        
        .new-diary {
            margin-top: 20px;
            padding: 15px;
            background-color: #f1f1f1;
            border-radius: 5px;
        }
        
        .new-diary textarea {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            min-height: 100px;
            font-family: '微软雅黑', sans-serif;
        }
        
        .delete-diary {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #ff6b6b;
            cursor: pointer;
            font-size: 18px;
            opacity: 0.7;
        }
        
        .delete-diary:hover {
            opacity: 1;
        }
        
        /* 手机适配 */
        @media (max-width: 768px) {
            .title { font-size: 32px; }
            .countdown { font-size: 24px; }
            .subtitle { font-size: 18px; }
            .nav-btn { font-size: 20px; width: 36px; height: 36px; }
            #music-player { padding: 8px 15px; gap: 10px; }
            #time-display { display: none; }
            #bg-toggle { bottom: 80px; right: 20px; }
            #video-control { bottom: 120px; right: 20px; }
            
            .modal-content {
                width: 95%;
                padding: 15px;
            }
            
            .diary-controls {
                flex-direction: column;
            }
            
            .diary-controls button {
                width: 100%;
            }
        }
        
        /* 新增弹幕样式 */
        #danmaku-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 500;
            overflow: hidden;
        }
        
        .danmaku {
            position: absolute;
            white-space: nowrap;
            color: white;
            font-size: 24px;
            font-weight: bold;
            opacity: 0.7;
            user-select: none;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        
        @keyframes danmakuMove {
            from { transform: translateX(100%); }
            to { transform: translateX(-100%); }
        }
        
        .danmaku-fast {
            animation: danmakuMove 8s linear infinite;
        }
        
        .danmaku-medium {
            animation: danmakuMove 12s linear infinite;
        }
        
        .danmaku-slow {
            animation: danmakuMove 16s linear infinite;
        }
        
        /* 响应式调整弹幕大小 */
        @media (max-width: 768px) {
            .danmaku {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <!-- 视频背景容器 -->
    <div id="video-container">
        <video id="background-video" autoplay muted loop playsinline>
            <source src="background.mp4" type="video/mp4">
        </video>
    </div>

    <!-- 加载提示 -->
    <div id="loading-overlay">
        <div class="loader"></div>
        <p>点击屏幕开启回忆</p>
    </div>

    <!-- 顶部导航栏 -->
    <div class="nav-bar">
        
        <i class="nav-btn" id="openDiary">📔</i>
        <i class="nav-btn" id="danmaku-toggle">💬</i>
    </div>

    <!-- 主内容区域 -->
    <div class="main-content">
        <h1 class="title">✨ LOVE 沫沫~ ~ ~ ✨</h1>
        <div class="countdown" id="loveDays">加载中...</div>
        <p class="subtitle">
            每一分每一秒<br>
            都是我们❤️
        </p>
    </div>

    <!-- 音乐播放器 -->
    <div id="music-player">
        <i id="music-icon" class="fa fa-play">▶️</i>
        <div id="music-progress">
            <div id="progress-bar"></div>
        </div>
        <div id="time-display">00:00</div>
    </div>

    <!-- 视频/图片切换按钮 -->
    <div id="bg-toggle">关闭背景</div>
    
    <!-- 视频控制按钮 -->
    <div id="video-control">下一个</div>

    <!-- 日记弹窗 -->
    <div id="diary-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>📔 我们的爱情日记</h2>
            <div id="diary-entries" class="diary-entries">
                <!-- 日记条目将通过JS动态添加 -->
            </div>
            <div class="diary-controls">
                <button id="add-diary">添加新日记</button>
                <button id="save-diaries">保存日记</button>
            </div>
        </div>
    </div>

    <!-- 弹幕容器 -->
    <div id="danmaku-container"></div>

    <!-- 背景音乐播放器 -->
    <audio id="backgroundMusic" loop>
        <source src="特别的人 - 方大同.mp3" type="audio/mpeg">
    </audio>

    <script>
        // 配置项
        const CONFIG = {
            loveStartDate: '2024-06-18', // 恋爱开始日期（YYYY-MM-DD）
            mediaList: [
                // 媒体项格式: {type: 'image'/'video', src: '路径', duration: 显示时长(仅图片需要)}
                {type: 'image', src: '1.jpg', duration: 5000},
                {type: 'image', src: '2.jpg', duration: 5000},
                {type: 'image', src: '3.jpg', duration: 5000},
                {type: 'image', src: '4.jpg', duration: 5000},
                {type: 'image', src: '5.jpg', duration: 5000},
                {type: 'image', src: '6.jpg', duration: 5000},
                {type: 'image', src: '7.jpg', duration: 5000},
                {type: 'image', src: '8.jpg', duration: 5000},
                {type: 'image', src: '9.jpg', duration: 5000},
                {type: 'image', src: '10.jpg', duration: 5000},
                {type: 'image', src: '11.jpg', duration: 5000},
                {type: 'image', src: '12.jpg', duration: 5000},
                {type: 'image', src: '13.jpg', duration: 5000},
                {type: 'image', src: '14.jpg', duration: 5000},
                {type: 'image', src: '15.jpg', duration: 5000},
                {type: 'image', src: '16.jpg', duration: 5000},
                {type: 'image', src: '17.jpg', duration: 5000},
                {type: 'image', src: '18.jpg', duration: 5000},
                {type: 'image', src: '19.jpg', duration: 5000},
                {type: 'image', src: '20.jpg', duration: 5000},
                {type: 'image', src: '21.jpg', duration: 5000},
                {type: 'image', src: '22.jpg', duration: 5000},
                {type: 'image', src: '23.jpg', duration: 5000},
                {type: 'image', src: '24.jpg', duration: 5000},
                {type: 'image', src: '25.jpg', duration: 5000},
                {type: 'image', src: '26.jpg', duration: 5000},
                {type: 'image', src: '27.jpg', duration: 5000},
                {type: 'image', src: '28.jpg', duration: 5000},
                {type: 'image', src: '29.jpg', duration: 5000},
                {type: 'image', src: '30.jpg', duration: 5000},
                {type: 'image', src: '31.jpg', duration: 5000},
                {type: 'image', src: '32.jpg', duration: 5000},
                {type: 'image', src: '33.jpg', duration: 5000},
                {type: 'image', src: '34.jpg', duration: 5000},
                {type: 'image', src: '35.jpg', duration: 5000},
                {type: 'image', src: '36.jpg', duration: 5000},
                {type: 'image', src: '37.jpg', duration: 5000},
                {type: 'image', src: '38.jpg', duration: 5000},
                {type: 'image', src: '39.jpg', duration: 5000},
                {type: 'image', src: '40.jpg', duration: 5000},
                {type: 'image', src: '41.jpg', duration: 5000},
                {type: 'image', src: '42.jpg', duration: 5000},
                {type: 'image', src: '43.jpg', duration: 5000},
                {type: 'image', src: '44.jpg', duration: 5000},
                {type: 'image', src: '45.jpg', duration: 5000},
                {type: 'image', src: '46.jpg', duration: 5000},
                {type: 'image', src: '47.jpg', duration: 5000},
                {type: 'image', src: '48.jpg', duration: 5000},
                {type: 'image', src: '49.jpg', duration: 5000},
                {type: 'image', src: '50.jpg', duration: 5000},
                {type: 'image', src: '51.jpg', duration: 5000},
                {type: 'image', src: '52.jpg', duration: 5000},
                {type: 'image', src: '53.jpg', duration: 5000},
                {type: 'image', src: '54.jpg', duration: 5000},
                {type: 'image', src: '55.jpg', duration: 5000},
                {type: 'image', src: '56.jpg', duration: 5000},
                {type: 'image', src: '57.jpg', duration: 5000},
                {type: 'image', src: '58.jpg', duration: 5000},
                {type: 'image', src: '59.jpg', duration: 5000},
                {type: 'image', src: '60.jpg', duration: 5000},
                {type: 'image', src: '61.jpg', duration: 5000},
                {type: 'image', src: '62.jpg', duration: 5000},
                {type: 'image', src: '63.jpg', duration: 5000},
                {type: 'image', src: '64.jpg', duration: 5000},
                {type: 'image', src: '65.jpg', duration: 5000},
                {type: 'image', src: '66.jpg', duration: 5000},
                {type: 'image', src: '67.jpg', duration: 5000},
                {type: 'image', src: '68.jpg', duration: 5000},
                {type: 'image', src: '69.jpg', duration: 5000},
                {type: 'image', src: '70.jpg', duration: 5000},
                {type: 'image', src: '71.jpg', duration: 5000},
                {type: 'image', src: '72.jpg', duration: 5000},
                {type: 'image', src: '73.jpg', duration: 5000},
                {type: 'image', src: '74.jpg', duration: 5000},
                {type: 'image', src: '75.jpg', duration: 5000},
                {type: 'image', src: '76.jpg', duration: 5000},
                {type: 'image', src: '77.jpg', duration: 5000},
                {type: 'image', src: '78.jpg', duration: 5000},
                

                {type: 'video', src: '1.mp4', duration: 12000},
                {type: 'video', src: '2.mp4', duration: 12000},
                {type: 'video', src: '3.mp4', duration: 12000},
                {type: 'video', src: '4.mp4', duration: 12000},
                {type: 'video', src: '5.mp4', duration: 12000},
                {type: 'video', src: '6.mp4', duration: 12000},
                {type: 'video', src: '7.mp4', duration: 12000},
                {type: 'video', src: '8.mp4', duration: 12000},
                {type: 'video', src: '9.mp4', duration: 12000},
                {type: 'video', src: '10.mp4', duration: 12000},
                {type: 'video', src: '11.mp4', duration: 12000},
                
                // 继续添加更多媒体...
            ],
            musicUrl: '特别的人 - 方大同.mp3', // 音乐文件地址
            initialVolume: 0.7, // 初始音量 (0-1)
            defaultToMediaPlayer: true, // 默认使用媒体播放器
            shuffleMedia: true, // 随机播放媒体
            
            // 弹幕相关配置 - 大幅减少弹幕文案数量
            danmakuTexts: [
                "陈老师，你的朋友圈真好看~ ~ ~",
                "你想要一个机会还是答案~",
                "如果我说都要，会不会比较贪心呀",
                "当然是要看哥哥怎么勾引我对我耍什么手段呀",
                "嘿嘿嘿~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ " ,
                "宝宝一周年快乐呀~ ~ ~ ~ ~  ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ",
                "现在是6.11号我终于写到弹幕了，真是难死了",
                "也不知道你看到会是什么心情嘞，嘿嘿嘿",
                "开心吗！！！        惊喜吗！！！           崇拜我吗！！！         我厉害吗！！！        低调低调呀宝宝！！！",
                "我简直太厉害了，这个是不是非常的小众！！！",
                "别人都是什么纪念册，什么书啥的",
                "遇到我这个网站，那些是不是都弱爆了！！！！！",
                "嘿嘿嘿其实之前有想过做那个书，结果被syn抢先了",
                "然后我就想怎么样能跟他那个不一样",
                "然后我就想到，网站也可以是差不多的效果",
                "而且比他们那些更厉害，还是动态的，更高级",
                "而且不会跟他们那些撞，这就是全世界独一份",
                "别人想要都没有嘿嘿嘿","你就偷着乐吧",
                "反正全网我都没有看到",
                "但是你现在看到的这个是我尝试了做跟纪念书差不多的，但是做出来会很丑",
                "所以我就做了这个",
                "嘻嘻嘻宝宝不要嫌弃哦，我会慢慢完善的",
                "不会放任不管哒",
                "OK呀不知道说啥啦，那就再说一下一周年快乐呀~",
                "其实咱们的小日子还挺平稳的，虽然一出事就是大事嘻嘻嘻",
                "所以就希望我们以后的爱情可以一帆风顺",
                "而且我们之前学校的事情都平稳过下来了，那以后肯定一帆风顺",
                "就希望我们以后可以少一点吵架，不要再相融之前",
                "大晚上给我发完消息就直接拉黑删除一条龙",
                "然后我以后也会乖乖的，不惹你生气啦~ ~ ~",
                "当然啦，咱们呢，前段时间是因为很长时间不见面，加上学校的事情心烦",
                "我觉得咱们后面肯定没有就不会啦对不对呀宝宝",
                "咱们也马上放假啦，等你看到这个的时候我们肯定就放假啦",
                "也不知道假期我们能不能出来玩~ ~ ~ ~ ~ ~ ~ ~ ~ ~",
                "有点想约会~ ~ ~ ~ ~ ~ ",
                "要是真的能约会，我记得可以去回顾下第一次见面的地，感觉太不错了呀",
                "当时老害羞了，怪放不开的，你当时还压力我",
                "瞪着我还，怪害怕的嘻嘻嘻",
                "还有点害羞",
                "现在再去就肯定不会啦，直接强吻你~ ~ ~ ~  ~",
                "不知不觉就一周年了",
                "时间过的好快哦",
                "真的是不知不觉的",
                "感觉昨天还在叫陈老师~ ~ ~ ~ ~",
                "嘿嘿嘿，希望我们以后可以少一点争吵嘿嘿",
                "希望我们的爱情，可以天长地久，永不分离",
                "虽然和我们宝宝在一起，我觉得还是快乐多一点",
                "但怕你因为吵架而有什么想法，所以我还是乖一点吧~ ~ ~",
                "爱你哟宝宝~ ~ ~嘿嘿嘿嘿嘿嘿嘿"
                
            ],
            danmakuInterval: 3000, // 弹幕出现间隔（毫秒）- 调整为5秒，避免过快
            maxActiveDanmakus: 1, // 最大同时显示的弹幕数量-改为1条，确保顺序清晰
            playDanmakuInOrder: true, // 新增配置：是否按顺序播放弹幕
        };

        // 全局变量
        let currentMediaIndex = 0;
        let mediaTimer;
        let danmakuTimer;
        let activeDanmakus = 0;
        let isDanmakuEnabled = true;
        let currentDanmakuIndex = 0; // 新增：当前弹幕索引

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            // 计算恋爱天数
            updateLoveDays();
            
            // 设置音乐
            const audio = document.getElementById('backgroundMusic');
            audio.volume = CONFIG.initialVolume;
            
            // 监听页面点击以解除移动端音频限制
            document.addEventListener('click', function startAudio() {
                if (audio.paused) {
                    audio.play().catch(e => console.log('音频自动播放被阻止:', e));
                }
                document.removeEventListener('click', startAudio);
            });
            
            // 初始化音乐播放器
            initMusicPlayer();
            
            // 初始化媒体播放器
            if (CONFIG.defaultToMediaPlayer && CONFIG.mediaList.length > 0) {
                setupMediaPlayer();
            }
            
            // 初始化日记系统
            loadDiaries();
            
            // 初始化弹幕系统
            startDanmakuSystem();
            
            // 监听加载完成
            window.addEventListener('load', function() {
                setTimeout(function() {
                    document.getElementById('loading-overlay').style.opacity = '0';
                    setTimeout(function() {
                        document.getElementById('loading-overlay').style.display = 'none';
                    }, 500);
                }, 1000);
            });
        });

        function updateLoveDays() {
            const start = new Date(CONFIG.loveStartDate);
            const now = new Date();
            const diff = now - start;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            document.getElementById('loveDays').textContent = `我们已经在一起：${days}天 ${hours}小时 ${minutes}分钟`;
        }

        
        // 初始化音乐播放器
        function initMusicPlayer() {
            const audio = document.getElementById('backgroundMusic');
            const musicIcon = document.getElementById('music-icon');
            const progressBar = document.getElementById('progress-bar');
            const timeDisplay = document.getElementById('time-display');
            const musicProgress = document.getElementById('music-progress');
            
            // 音乐播放/暂停切换
            musicIcon.addEventListener('click', function() {
                if (audio.paused) {
                    audio.play().catch(e => console.log('音频播放被阻止:', e));
                    musicIcon.textContent = '⏸️';
                } else {
                    audio.pause();
                    musicIcon.textContent = '▶️';
                }
            });
            
            // 更新进度条
            audio.addEventListener('timeupdate', function() {
                const percent = (audio.currentTime / audio.duration) * 100;
                progressBar.style.width = percent + '%';
                
                // 更新时间显示
                const currentMinutes = Math.floor(audio.currentTime / 60);
                const currentSeconds = Math.floor(audio.currentTime % 60);
                const durationMinutes = Math.floor(audio.duration / 60);
                const durationSeconds = Math.floor(audio.duration % 60);
                
                timeDisplay.textContent = `${padZero(currentMinutes)}:${padZero(currentSeconds)} / ${padZero(durationMinutes)}:${padZero(durationSeconds)}`;
            });
            
            // 点击进度条跳转到指定位置
            musicProgress.addEventListener('click', function(e) {
                const rect = musicProgress.getBoundingClientRect();
                const pos = (e.clientX - rect.left) / rect.width;
                audio.currentTime = pos * audio.duration;
            });
            
            // 格式化时间（添加前导零）
            function padZero(num) {
                return num < 10 ? '0' + num : num;
            }
        }

        // 设置媒体播放器
        function setupMediaPlayer() {
            const videoContainer = document.getElementById('video-container');
            const backgroundVideo = document.getElementById('background-video');
            const bgToggle = document.getElementById('bg-toggle');
            const videoControl = document.getElementById('video-control');
            
            // 随机排序媒体列表
            if (CONFIG.shuffleMedia) {
                CONFIG.mediaList.sort(() => Math.random() - 0.5);
            }
            
            // 显示第一个媒体
            displayMedia(0);
            
            // 背景切换按钮
            bgToggle.addEventListener('click', function() {
                if (videoContainer.style.opacity === '0' || videoContainer.style.opacity === '') {
                    videoContainer.style.opacity = '1';
                    bgToggle.textContent = '关闭背景';
                } else {
                    videoContainer.style.opacity = '0';
                    bgToggle.textContent = '打开背景';
                }
            });
            
            // 下一个媒体按钮
            videoControl.addEventListener('click', function() {
                currentMediaIndex = (currentMediaIndex + 1) % CONFIG.mediaList.length;
                displayMedia(currentMediaIndex);
            });
        }

        // 显示指定索引的媒体
        function displayMedia(index) {
            const media = CONFIG.mediaList[index];
            const videoContainer = document.getElementById('video-container');
            const backgroundVideo = document.getElementById('background-video');
            
            // 清除之前的计时器
            if (mediaTimer) {
                clearTimeout(mediaTimer);
            }
            
            if (media.type === 'video') {
                // 显示视频
                backgroundVideo.src = media.src;
                backgroundVideo.load();
                backgroundVideo.play();
                
                // 视频播放结束后自动切换到下一个
                backgroundVideo.onended = function() {
                    currentMediaIndex = (currentMediaIndex + 1) % CONFIG.mediaList.length;
                    displayMedia(currentMediaIndex);
                };
                
                videoContainer.style.opacity = '1';
            } else if (media.type === 'image') {
                // 显示图片
                const img = new Image();
                img.onload = function() {
                    // 创建一个临时元素来显示图片
                    const imgElement = document.createElement('div');
                    imgElement.style.backgroundImage = `url('${media.src}')`;
                    imgElement.style.backgroundSize = 'cover';
                    imgElement.style.backgroundPosition = 'center';
                    imgElement.style.position = 'absolute';
                    imgElement.style.top = '0';
                    imgElement.style.left = '0';
                    imgElement.style.width = '100%';
                    imgElement.style.height = '100%';
                    
                    // 替换视频容器内容
                    while (videoContainer.firstChild) {
                        videoContainer.removeChild(videoContainer.firstChild);
                    }
                    videoContainer.appendChild(imgElement);
                    videoContainer.style.opacity = '1';
                    
                    // 设置计时器切换到下一个媒体
                    mediaTimer = setTimeout(function() {
                        currentMediaIndex = (currentMediaIndex + 1) % CONFIG.mediaList.length;
                        displayMedia(currentMediaIndex);
                    }, media.duration);
                };
                img.src = media.src;
            }
        }

        

        // 初始化日记系统
        function loadDiaries() {
            const diaryEntries = document.getElementById('diary-entries');
            const addDiaryBtn = document.getElementById('add-diary');
            const saveDiariesBtn = document.getElementById('save-diaries');
            const diaryModal = document.getElementById('diary-modal');
            const openDiaryBtn = document.getElementById('openDiary');
            const closeModal = document.querySelector('.close-modal');
            

            // 初始日记数据（可从本地存储加载）
        let diaries = JSON.parse(localStorage.getItem('loveDiaries')) || [
                {
                    date: '2025-06-09',
                    content: '今天是周一，前两天突发奇想（大概是3号），想给我们做一个网站（其实也不是突发奇想，我之前就有想到过，用独特的方式记录一下我们）那为什么是今天才开始有日记呢，那是因为今天才把网站的框架搭好嘻嘻嘻'
                },
                {
                    date: '2025-06-10',
                    content: '今天是周二，我们今天考试了，嘻嘻嘻嘻嘻有点没亲够，还想亲亲~，咱们今天还说马上一周年，我们该咋过呀，我也在思考，嘤嘤嘤，我也不知道咋过，都不知道能不能见面嘞'
                },
                {
                    date: '2025-06-11',
                    content: '今天是周三，我们今天又考试了，今天还是想亲亲~ ~ ~，今天考试你像小傻蛋怪可爱的嘞，但是最后你还白眼我让我好心寒哦，现在是晚自习，我在思考什么时候把网站告诉你 给你看，是周五还是18号呢，好纠结'
                },

            ];

            // 从本地存储加载日记
            // let diaries = JSON.parse(localStorage.getItem('loveDiaries')) || [];
            
            // 渲染日记列表
            renderDiaries(diaries);
            
            // 打开日记模态框
            openDiaryBtn.addEventListener('click', function() {
                diaryModal.style.display = 'flex';
            });
            
            // 关闭日记模态框
            closeModal.addEventListener('click', function() {
                diaryModal.style.display = 'none';
            });
            
            // 点击模态框外部关闭
            diaryModal.addEventListener('click', function(e) {
                if (e.target === diaryModal) {
                    diaryModal.style.display = 'none';
                }
            });
            
            // 添加新日记
            addDiaryBtn.addEventListener('click', function() {
                const newDiaryDiv = document.createElement('div');
                newDiaryDiv.className = 'new-diary';
                newDiaryDiv.innerHTML = `
                    <div class="diary-date">今天</div>
                    <textarea placeholder="写下今天的感受..."></textarea>
                    <button class="save-diary">保存</button>
                    <button class="cancel-diary">取消</button>
                `;
                
                diaryEntries.appendChild(newDiaryDiv);
                
                // 保存新日记
                newDiaryDiv.querySelector('.save-diary').addEventListener('click', function() {
                    const content = newDiaryDiv.querySelector('textarea').value;
                    if (content.trim()) {
                        const newDiary = {
                            date: new Date().toLocaleDateString(),
                            content: content
                        };
                        
                        diaries.unshift(newDiary); // 添加到数组开头
                        renderDiaries(diaries);
                        saveDiaries(diaries);
                    }
                    diaryEntries.removeChild(newDiaryDiv);
                });
                
                // 取消添加
                newDiaryDiv.querySelector('.cancel-diary').addEventListener('click', function() {
                    diaryEntries.removeChild(newDiaryDiv);
                });
            });
            
            // 保存所有日记
            saveDiariesBtn.addEventListener('click', function() {
                saveDiaries(diaries);
            });
            
            // 渲染日记列表
            function renderDiaries(diaries) {
                diaryEntries.innerHTML = '';
                
                diaries.forEach(function(diary, index) {
                    const entryDiv = document.createElement('div');
                    entryDiv.className = 'diary-entry';
                    entryDiv.innerHTML = `
                        <div class="diary-date">${diary.date}</div>
                        <div class="diary-content">${diary.content}</div>
                        <span class="delete-diary" data-index="${index}">❌</span>
                    `;
                    
                    diaryEntries.appendChild(entryDiv);
                    
                    // 删除日记
                    entryDiv.querySelector('.delete-diary').addEventListener('click', function() {
                        if (confirm('确定要删除这篇日记吗？')) {
                            diaries.splice(index, 1);
                            renderDiaries(diaries);
                            saveDiaries(diaries);
                        }
                    });
                });
            }
            
            // 保存日记到本地存储
            function saveDiaries(diaries) {
                localStorage.setItem('loveDiaries', JSON.stringify(diaries));
                alert('日记已保存');
            }
        }

        // 弹幕系统
        function startDanmakuSystem() {
            const danmakuContainer = document.getElementById('danmaku-container');
            const danmakuToggle = document.getElementById('danmaku-toggle');
            
            // 切换弹幕开关
            danmakuToggle.addEventListener('click', function() {
                isDanmakuEnabled = !isDanmakuEnabled;
                danmakuToggle.textContent = isDanmakuEnabled ? '💬' : '❌';
                
                if (isDanmakuEnabled) {
                    startDanmakuTimer();
                } else {
                    clearTimeout(danmakuTimer);
                    // 清除所有现有弹幕
                    while (danmakuContainer.firstChild) {
                        danmakuContainer.removeChild(danmakuContainer.firstChild);
                    }
                    activeDanmakus = 0;
                }
            });
            
            // 开始弹幕计时器
            startDanmakuTimer();
            
            function startDanmakuTimer() {
                if (isDanmakuEnabled) {
                    danmakuTimer = setTimeout(createDanmaku, CONFIG.danmakuInterval);
                }
            }
            
            // 创建弹幕
            function createDanmaku() {
                if (!isDanmakuEnabled || activeDanmakus >= CONFIG.maxActiveDanmakus) {
                    startDanmakuTimer();
                    return;
                }
                
                // 按顺序获取弹幕文本（修改为顺序模式）
                let text = CONFIG.danmakuTexts[currentDanmakuIndex];
                currentDanmakuIndex = (currentDanmakuIndex + 1) % CONFIG.danmakuTexts.length; // 循环索引
                
                // 创建弹幕元素
                const danmaku = document.createElement('div');
                danmaku.className = 'danmaku';
                danmaku.textContent = text;
                
                // 随机选择速度和位置
                const speeds = ['fast', 'medium', 'slow'];
                const randomSpeed = speeds[Math.floor(Math.random() * speeds.length)];
                danmaku.classList.add(`danmaku-${randomSpeed}`);
                
                // 随机垂直位置（避开顶部导航和底部播放器）
                const topPosition = Math.floor(Math.random() * 70) + 15; // 15% 到 85% 之间
                danmaku.style.top = `${topPosition}%`;
                
                // 添加到容器
                danmakuContainer.appendChild(danmaku);
                activeDanmakus++;
                
                // 设置弹幕消失
                const duration = randomSpeed === 'fast' ? 8000 : randomSpeed === 'medium' ? 12000 : 16000;
                setTimeout(function() {
                    if (danmaku.parentNode === danmakuContainer) {
                        danmakuContainer.removeChild(danmaku);
                        activeDanmakus--;
                    }
                }, duration);
                
                // 继续创建下一条弹幕
                startDanmakuTimer();
            }
        }
    </script>
</body>
</html>
