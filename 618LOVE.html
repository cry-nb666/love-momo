<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ¨è®°å½•å’Œæ²«æ²«çš„å°ç½‘ç«™âœ¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'å¾®è½¯é›…é»‘', sans-serif;
        }

        body {
            min-height: 100vh;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            transition: background-image 1s ease; /* èƒŒæ™¯åˆ‡æ¢è¿‡æ¸¡æ•ˆæœ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #000; /* åˆå§‹èƒŒæ™¯è‰² */
            overflow: hidden;
        }

        /* è§†é¢‘èƒŒæ™¯å®¹å™¨ */
        #video-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
            opacity: 0;
            transition: opacity 1s ease;
        }

        #background-video {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 100%;
            min-height: 100%;
            object-fit: cover;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .nav-bar {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            color: white;
            font-size: 24px;
            cursor: pointer;
            background-color: rgba(0,0,0,0.3);
            padding: 8px 12px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background-color: rgba(0,0,0,0.6);
            transform: scale(1.1);
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            text-align: center;
            color: white;
            padding: 50px;
            z-index: 100;
            animation: fadeIn 1.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .title {
            font-size: 48px;
            color: #ff6b6b;
            margin-bottom: 20px;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .countdown {
            font-size: 36px;
            color: #4ecdc4;
            margin: 20px 0;
            text-shadow: 1px 1px 5px rgba(0,0,0,0.5);
        }

        .subtitle {
            font-size: 24px;
            color: #f7fff7;
            margin-bottom: 50px;
            line-height: 1.6;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* éŸ³ä¹æ’­æ”¾å™¨æ ·å¼ */
        #music-player {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background-color: rgba(0,0,0,0.5);
            padding: 10px 20px;
            border-radius: 30px;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        #music-toggle {
            cursor: pointer;
            font-size: 20px;
        }

        #music-progress {
            flex-grow: 1;
            height: 4px;
            background-color: rgba(255,255,255,0.2);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
            max-width: 200px;
        }

        #progress-bar {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background-color: #ff6b6b;
            border-radius: 2px;
            width: 0%;
        }

        #time-display {
            font-size: 14px;
            min-width: 60px;
            text-align: center;
        }

        /* åŠ è½½æç¤º */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            transition: opacity 0.5s ease;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid #ff6b6b;
            border-bottom-color: transparent;
            border-radius: 50%;
            animation: rotation 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* è§†é¢‘/å›¾ç‰‡åˆ‡æ¢æŒ‰é’® */
        #bg-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background-color: rgba(0,0,0,0.5);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        #bg-toggle:hover {
            background-color: rgba(0,0,0,0.8);
        }

        /* è§†é¢‘æ§åˆ¶æŒ‰é’® */
        #video-control {
            position: fixed;
            bottom: 20px;
            right: 160px;
            z-index: 1000;
            background-color: rgba(0,0,0,0.5);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        #video-control:hover {
            background-color: rgba(0,0,0,0.8);
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: modalIn 0.3s ease;
        }
        
        @keyframes modalIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .close-modal {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
            color: #666;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .diary-entry {
            margin-bottom: 20px;
            padding: 15px;
            border-left: 3px solid #ff6b6b;
            background-color: #f9f9f9;
            border-radius: 5px;
            position: relative;
        }
        
        .diary-date {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 5px;
        }
        
        .diary-content {
            line-height: 1.6;
        }
        
        .diary-controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        
        .diary-controls button {
            flex-grow: 1;
            padding: 8px 15px;
            background-color: #ff6b6b;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .diary-controls button:hover {
            background-color: #e65252;
        }
        
        .new-diary {
            margin-top: 20px;
            padding: 15px;
            background-color: #f1f1f1;
            border-radius: 5px;
        }
        
        .new-diary textarea {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            min-height: 100px;
            font-family: 'å¾®è½¯é›…é»‘', sans-serif;
        }
        
        .delete-diary {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #ff6b6b;
            cursor: pointer;
            font-size: 18px;
            opacity: 0.7;
        }
        
        .delete-diary:hover {
            opacity: 1;
        }
        
        /* æ‰‹æœºé€‚é… */
        @media (max-width: 768px) {
            .title { font-size: 32px; }
            .countdown { font-size: 24px; }
            .subtitle { font-size: 18px; }
            .nav-btn { font-size: 20px; width: 36px; height: 36px; }
            #music-player { padding: 8px 15px; gap: 10px; }
            #time-display { display: none; }
            #bg-toggle { bottom: 80px; right: 20px; }
            #video-control { bottom: 120px; right: 20px; }
            
            .modal-content {
                width: 95%;
                padding: 15px;
            }
            
            .diary-controls {
                flex-direction: column;
            }
            
            .diary-controls button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- è§†é¢‘èƒŒæ™¯å®¹å™¨ -->
    <div id="video-container">
        <video id="background-video" autoplay muted loop playsinline>
            <source src="background.mp4" type="video/mp4">
            <!-- å¯æ›¿æ¢ä¸ºä½ çš„è§†é¢‘æ–‡ä»¶ -->
        </video>
    </div>

    <!-- åŠ è½½æç¤º -->
    <div id="loading-overlay">
        <div class="loader"></div>
        <p>ç‚¹å‡»å±å¹•å¼€å§‹æˆ‘ä»¬çš„å›å¿†ä¹‹æ—…</p>
    </div>

    <!-- é¡¶éƒ¨å¯¼èˆªæ ï¼ˆå¯æ‰©å±•åŠŸèƒ½æŒ‰é’®ï¼‰ -->
    <div class="nav-bar">
        <i class="nav-btn" id="music-toggle">ğŸµ</i>
        <i class="nav-btn" id="openDiary">ğŸ“”</i>
    </div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
        <h1 class="title">âœ¨ ä¸“å±æˆ‘ä»¬çš„çˆ±æƒ… âœ¨</h1>
        <div class="countdown" id="loveDays">åŠ è½½ä¸­...</div>
        <p class="subtitle">
            æ¯ä¸€åˆ†æ¯ä¸€ç§’ï¼Œ<br>
            éƒ½æ˜¯æˆ‘ä»¬ â¤ï¸
        </p>
    </div>

    <!-- éŸ³ä¹æ’­æ”¾å™¨ -->
    <div id="music-player">
        <i id="music-icon" class="fa fa-play">â–¶ï¸</i>
        <div id="music-progress">
            <div id="progress-bar"></div>
        </div>
        <div id="time-display">00:00</div>
    </div>

    <!-- è§†é¢‘/å›¾ç‰‡åˆ‡æ¢æŒ‰é’® -->
    <div id="bg-toggle">å…³é—­èƒŒæ™¯</div>
    
    <!-- è§†é¢‘æ§åˆ¶æŒ‰é’® -->
    <div id="video-control">ä¸‹ä¸€ä¸ª</div>

    <!-- æ—¥è®°å¼¹çª— -->
    <div id="diary-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>ğŸ“” æˆ‘ä»¬çš„çˆ±æƒ…æ—¥è®°</h2>
            <div id="diary-entries" class="diary-entries">
                <!-- æ—¥è®°æ¡ç›®å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>
            <div class="diary-controls">
                <button id="add-diary">æ·»åŠ æ–°æ—¥è®°</button>
                <button id="save-diaries">ä¿å­˜æ—¥è®°</button>
            </div>
        </div>
    </div>

    <!-- èƒŒæ™¯éŸ³ä¹æ’­æ”¾å™¨ -->
    <audio id="backgroundMusic" loop>
        <source src="ç‰¹åˆ«çš„äºº - æ–¹å¤§åŒ.mp3" type="audio/mpeg">
        <!-- å¯æ›¿æ¢ä¸ºå…¶ä»–éŸ³ä¹å¹³å°å¤–é“¾ï¼Œå¦‚ç½‘æ˜“äº‘éŸ³ä¹/QQéŸ³ä¹çš„å¤–é“¾ -->
    </audio>

    <script>
        // é…ç½®é¡¹ - è¯·åŠ¡å¿…ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼
        const CONFIG = {
            loveStartDate: '2024-06-18', // æ‹çˆ±å¼€å§‹æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
            mediaList: [
                // åª’ä½“é¡¹æ ¼å¼: {type: 'image'/'video', src: 'è·¯å¾„', duration: æ˜¾ç¤ºæ—¶é•¿(ä»…å›¾ç‰‡éœ€è¦)}
                {type: 'image', src: '1.jpg', duration: 5000},
                {type: 'image', src: '2.jpg', duration: 5000},
                {type: 'image', src: '3.jpg', duration: 5000},
                {type: 'image', src: '4.jpg', duration: 5000},
                {type: 'image', src: '5.jpg', duration: 5000},
                {type: 'image', src: '6.jpg', duration: 5000},
                {type: 'image', src: '7.jpg', duration: 5000},
                {type: 'image', src: '8.jpg', duration: 5000},
                {type: 'image', src: '9.jpg', duration: 5000},
                {type: 'image', src: '10.jpg', duration: 5000},
                {type: 'image', src: '11.jpg', duration: 5000},
                {type: 'image', src: '12.jpg', duration: 5000},
                {type: 'image', src: '13.jpg', duration: 5000},
                {type: 'image', src: '14.jpg', duration: 5000},
                {type: 'image', src: '15.jpg', duration: 5000},
                {type: 'image', src: '16.jpg', duration: 5000},
                {type: 'image', src: '17.jpg', duration: 5000},
                {type: 'image', src: '18.jpg', duration: 5000},
                {type: 'image', src: '19.jpg', duration: 5000},
                {type: 'image', src: '20.jpg', duration: 5000},
                {type: 'image', src: '21.jpg', duration: 5000},
                {type: 'image', src: '22.jpg', duration: 5000},
                {type: 'image', src: '23.jpg', duration: 5000},
                {type: 'image', src: '24.jpg', duration: 5000},
                {type: 'image', src: '25.jpg', duration: 5000},
                {type: 'image', src: '26.jpg', duration: 5000},
                {type: 'image', src: '27.jpg', duration: 5000},
                {type: 'image', src: '28.jpg', duration: 5000},
                {type: 'image', src: '29.jpg', duration: 5000},
                {type: 'image', src: '30.jpg', duration: 5000},
                {type: 'image', src: '31.jpg', duration: 5000},
                {type: 'image', src: '32.jpg', duration: 5000},
                {type: 'image', src: '33.jpg', duration: 5000},
                {type: 'image', src: '34.jpg', duration: 5000},
                {type: 'image', src: '35.jpg', duration: 5000},
                {type: 'image', src: '36.jpg', duration: 5000},
                {type: 'image', src: '37.jpg', duration: 5000},
                {type: 'image', src: '38.jpg', duration: 5000},
                {type: 'image', src: '39.jpg', duration: 5000},
                {type: 'image', src: '40.jpg', duration: 5000},
                {type: 'image', src: '41.jpg', duration: 5000},
                {type: 'image', src: '42.jpg', duration: 5000},
                {type: 'image', src: '43.jpg', duration: 5000},
                {type: 'image', src: '44.jpg', duration: 5000},
                {type: 'image', src: '45.jpg', duration: 5000},
                {type: 'image', src: '46.jpg', duration: 5000},
                {type: 'image', src: '47.jpg', duration: 5000},
                {type: 'image', src: '48.jpg', duration: 5000},
                {type: 'image', src: '49.jpg', duration: 5000},
                {type: 'image', src: '50.jpg', duration: 5000},
                {type: 'image', src: '51.jpg', duration: 5000},
                {type: 'image', src: '52.jpg', duration: 5000},
                {type: 'image', src: '53.jpg', duration: 5000},
                {type: 'image', src: '54.jpg', duration: 5000},
                {type: 'image', src: '55.jpg', duration: 5000},
                {type: 'image', src: '56.jpg', duration: 5000},
                {type: 'image', src: '57.jpg', duration: 5000},
                {type: 'image', src: '58.jpg', duration: 5000},
                {type: 'image', src: '59.jpg', duration: 5000},
                {type: 'image', src: '60.jpg', duration: 5000},
                {type: 'image', src: '61.jpg', duration: 5000},
                {type: 'image', src: '62.jpg', duration: 5000},
                {type: 'image', src: '63.jpg', duration: 5000},
                {type: 'image', src: '64.jpg', duration: 5000},
                {type: 'image', src: '65.jpg', duration: 5000},
                {type: 'image', src: '66.jpg', duration: 5000},
                {type: 'image', src: '67.jpg', duration: 5000},
                {type: 'image', src: '68.jpg', duration: 5000},
                {type: 'image', src: '69.jpg', duration: 5000},
                {type: 'image', src: '70.jpg', duration: 5000},
                {type: 'image', src: '71.jpg', duration: 5000},
                {type: 'image', src: '72.jpg', duration: 5000},
                {type: 'image', src: '73.jpg', duration: 5000},
                {type: 'image', src: '74.jpg', duration: 5000},
                {type: 'image', src: '75.jpg', duration: 5000},
                {type: 'image', src: '76.jpg', duration: 5000},
                {type: 'image', src: '77.jpg', duration: 5000},
                {type: 'image', src: '78.jpg', duration: 5000},
                

                {type: 'video', src: '1.mp4', duration: 12000},
                {type: 'video', src: '2.mp4', duration: 12000},
                {type: 'video', src: '3.mp4', duration: 12000},
                {type: 'video', src: '4.mp4', duration: 12000},
                {type: 'video', src: '5.mp4', duration: 12000},
                {type: 'video', src: '6.mp4', duration: 12000},
                {type: 'video', src: '7.mp4', duration: 12000},
                {type: 'video', src: '8.mp4', duration: 12000},
                {type: 'video', src: '9.mp4', duration: 12000},
                {type: 'video', src: '10.mp4', duration: 12000},
                {type: 'video', src: '11.mp4', duration: 12000},
                
                // ç»§ç»­æ·»åŠ æ›´å¤šåª’ä½“...
            ],
            musicUrl: 'ç‰¹åˆ«çš„äºº - æ–¹å¤§åŒ.mp3', // éŸ³ä¹æ–‡ä»¶åœ°å€
            initialVolume: 0.7, // åˆå§‹éŸ³é‡ (0-1)
            defaultToMediaPlayer: true, // é»˜è®¤ä½¿ç”¨åª’ä½“æ’­æ”¾å™¨
            shuffleMedia: true // éšæœºæ’­æ”¾åª’ä½“
        };

        // çŠ¶æ€å˜é‡
        let usingMediaPlayer = CONFIG.defaultToMediaPlayer;
        let mediaIndex = 0;
        let mediaChangeTimer = null;
        let isPlaying = false;
        let backgroundVideoLoaded = false; // æ·»åŠ è§†é¢‘åŠ è½½çŠ¶æ€å˜é‡

        // ----------------- å·¥å…·å‡½æ•° -----------------
        // æ ¼å¼åŒ–æ—¶é—´ä¸º MM:SS
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        // æ“ä½œCookie
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        // ----------------- æ‹çˆ±æ—¶é•¿è®¡ç®— -----------------
        function updateLoveDays() {
            const start = new Date(CONFIG.loveStartDate);
            const now = new Date();
            const diff = now - start;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            document.getElementById('loveDays').textContent = `æˆ‘ä»¬å·²ç»åœ¨ä¸€èµ·ï¼š${days}å¤© ${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ`;
        }

        // ----------------- èƒŒæ™¯æ§åˆ¶ -----------------
        // åŠ è½½åª’ä½“ï¼ˆå›¾ç‰‡æˆ–è§†é¢‘ï¼‰
        function loadMedia(mediaItem) {
            const videoContainer = document.getElementById('video-container');
            const backgroundVideo = document.getElementById('background-video');
            const body = document.body;
            
            // éšè—å½“å‰åª’ä½“
            if (mediaItem.type === 'video') {
                // è§†é¢‘èƒŒæ™¯
                videoContainer.style.opacity = '0';
                body.style.backgroundImage = 'none';
                
                // é‡ç½®è§†é¢‘
                backgroundVideo.pause();
                backgroundVideo.src = mediaItem.src;
                backgroundVideo.load();
                
                // è§†é¢‘åŠ è½½å®Œæˆåæ˜¾ç¤º
                backgroundVideo.addEventListener('canplay', () => {
                    backgroundVideoLoaded = true;
                    if (usingMediaPlayer && isPlaying) {
                        videoContainer.style.opacity = '1';
                        backgroundVideo.play().catch(e => console.log('è§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', e));
                        
                        // è®¾ç½®ä¸‹ä¸€ä¸ªåª’ä½“åˆ‡æ¢æ—¶é—´
                        setupMediaChangeTimer(mediaItem.duration);
                    }
                }, { once: true });
                
                // è§†é¢‘åŠ è½½é”™è¯¯æ—¶å›é€€åˆ°ä¸‹ä¸€ä¸ªåª’ä½“
                backgroundVideo.addEventListener('error', () => {
                    console.error('è§†é¢‘åŠ è½½å¤±è´¥ï¼ŒåŠ è½½ä¸‹ä¸€ä¸ªåª’ä½“');
                    playNextMedia();
                }, { once: true });
            } else {
                // å›¾ç‰‡èƒŒæ™¯
                videoContainer.style.opacity = '0';
                body.style.backgroundImage = `url('${mediaItem.src}')`;
                
                // è®¾ç½®ä¸‹ä¸€ä¸ªåª’ä½“åˆ‡æ¢æ—¶é—´
                setupMediaChangeTimer(mediaItem.duration);
            }
        }

        // è®¾ç½®åª’ä½“åˆ‡æ¢è®¡æ—¶å™¨
        function setupMediaChangeTimer(duration) {
            if (mediaChangeTimer) {
                clearInterval(mediaChangeTimer);
            }
            
            mediaChangeTimer = setInterval(playNextMedia, duration);
        }

        // æ’­æ”¾ä¸‹ä¸€ä¸ªåª’ä½“
        function playNextMedia() {
            if (CONFIG.mediaList.length === 0) return;
            
            // é€‰æ‹©ä¸‹ä¸€ä¸ªåª’ä½“
            if (CONFIG.shuffleMedia) {
                mediaIndex = Math.floor(Math.random() * CONFIG.mediaList.length);
            } else {
                mediaIndex = (mediaIndex + 1) % CONFIG.mediaList.length;
            }
            
            // åŠ è½½æ–°åª’ä½“
            loadMedia(CONFIG.mediaList[mediaIndex]);
        }

        // åˆ‡æ¢åª’ä½“æ’­æ”¾å™¨çŠ¶æ€
        function toggleMediaPlayer() {
            usingMediaPlayer = !usingMediaPlayer;
            
            if (usingMediaPlayer) {
                // å¯ç”¨åª’ä½“æ’­æ”¾å™¨
                document.getElementById('bg-toggle').textContent = 'å…³é—­èƒŒæ™¯';
                
                // å¦‚æœæœ‰åª’ä½“åˆ—è¡¨ï¼Œå¼€å§‹æ’­æ”¾
                if (CONFIG.mediaList.length > 0) {
                    isPlaying = true;
                    loadMedia(CONFIG.mediaList[mediaIndex]);
                }
            } else {
                // å…³é—­åª’ä½“æ’­æ”¾å™¨
                document.getElementById('bg-toggle').textContent = 'æ‰“å¼€èƒŒæ™¯';
                
                // åœæ­¢å½“å‰æ’­æ”¾
                isPlaying = false;
                if (mediaChangeTimer) {
                    clearInterval(mediaChangeTimer);
                }
                
                // æ˜¾ç¤ºé»˜è®¤èƒŒæ™¯
                const body = document.body;
                body.style.backgroundImage = '';
                body.style.backgroundColor = '#000';
            }
        }

        // ----------------- éŸ³ä¹æ§åˆ¶ -----------------
        function setupMusicControl() {
            const audio = document.getElementById('backgroundMusic');
            const musicIcon = document.getElementById('music-icon');
            const musicProgress = document.getElementById('music-progress');
            const progressBar = document.getElementById('progress-bar');
            const timeDisplay = document.getElementById('time-display');
            
            // è®¾ç½®éŸ³é‡
            audio.volume = CONFIG.initialVolume;
            
            // æ£€æŸ¥ç”¨æˆ·ä¹‹å‰çš„éŸ³ä¹åå¥½
            const musicPreference = getCookie('music_preference');
            if (musicPreference === 'mute') {
                audio.muted = true;
                musicIcon.textContent = 'ğŸ”‡';
            }
            
            // å°è¯•è‡ªåŠ¨æ’­æ”¾éŸ³ä¹
            function tryPlayMusic() {
                audio.play().then(() => {
                    // æ’­æ”¾æˆåŠŸ
                    musicIcon.textContent = 'ğŸ”Š';
                    hideLoadingOverlay();
                }).catch(e => {
                    console.log('è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', e);
                    // æ˜¾ç¤ºåŠ è½½æç¤ºï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’
                    document.getElementById('loading-overlay').querySelector('p').textContent = 'ç‚¹å‡»å±å¹•æ’­æ”¾éŸ³ä¹';
                });
            }
            
            // ç”¨æˆ·é¦–æ¬¡äº¤äº’æ—¶æ’­æ”¾éŸ³ä¹å’Œè§†é¢‘
            function handleFirstInteraction() {
                if (audio.paused) {
                    tryPlayMusic();
                    // é¦–æ¬¡äº¤äº’æ—¶ä¹Ÿå°è¯•æ’­æ”¾è§†é¢‘
                    const backgroundVideo = document.getElementById('background-video');
                    if (usingMediaPlayer && backgroundVideo.paused && backgroundVideoLoaded) {
                        backgroundVideo.play().catch(e => console.log('è§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', e));
                    }
                }
                // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨ï¼Œé¿å…é‡å¤è§¦å‘
                document.removeEventListener('click', handleFirstInteraction);
                document.removeEventListener('touchstart', handleFirstInteraction);
            }
            
            // æ·»åŠ é¦–æ¬¡äº¤äº’ç›‘å¬å™¨
            document.addEventListener('click', handleFirstInteraction);
            document.addEventListener('touchstart', handleFirstInteraction);
            
            // éŸ³ä¹æ§åˆ¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            musicIcon.addEventListener('click', () => {
                if (audio.paused) {
                    audio.play();
                    musicIcon.textContent = 'ğŸ”Š';
                    setCookie('music_preference', 'play', 365);
                } else {
                    audio.pause();
                    musicIcon.textContent = 'â¸ï¸';
                    setCookie('music_preference', 'pause', 365);
                }
            });
            
            // é™éŸ³/å–æ¶ˆé™éŸ³
            document.getElementById('music-toggle').addEventListener('click', () => {
                audio.muted = !audio.muted;
                if (audio.muted) {
                    musicIcon.textContent = 'ğŸ”‡';
                    setCookie('music_preference', 'mute', 365);
                } else {
                    musicIcon.textContent = 'ğŸ”Š';
                    setCookie('music_preference', 'unmute', 365);
                }
            });
            
            // æ›´æ–°è¿›åº¦æ¡å’Œæ—¶é—´æ˜¾ç¤º
            audio.addEventListener('timeupdate', () => {
                const progress = (audio.currentTime / audio.duration) * 100;
                progressBar.style.width = `${progress}%`;
                timeDisplay.textContent = formatTime(audio.currentTime);
            });
            
            // ç‚¹å‡»è¿›åº¦æ¡è·³è½¬
            musicProgress.addEventListener('click', (e) => {
                const progressWidth = musicProgress.clientWidth;
                const clickPosition = e.offsetX;
                const seekTime = (clickPosition / progressWidth) * audio.duration;
                audio.currentTime = seekTime;
            });
            
            // éŸ³ä¹åŠ è½½å®Œæˆ
            audio.addEventListener('loadedmetadata', () => {
                timeDisplay.textContent = formatTime(audio.currentTime);
            });
            
            // ç›‘å¬éŸ³ä¹æ’­æ”¾çŠ¶æ€æ›´æ–°æŒ‰é’®å›¾æ ‡
            audio.addEventListener('play', () => {
                musicIcon.textContent = 'ğŸ”Š';
            });
            
            audio.addEventListener('pause', () => {
                musicIcon.textContent = 'â¸ï¸';
            });
        }

        // ----------------- åŠ è½½è¦†ç›–å±‚æ§åˆ¶ -----------------
        function hideLoadingOverlay() {
            const loadingOverlay = document.getElementById('loading-overlay');
            loadingOverlay.style.opacity = '0';
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
            }, 500);
        }

        // ----------------- æ—¥è®°åŠŸèƒ½å®ç° -----------------
        function setupDiaryFunctionality() {
            const diaryModal = document.getElementById('diary-modal');
            const closeModal = document.querySelector('.close-modal');
            const openDiaryBtn = document.getElementById('openDiary');
            const diaryEntries = document.getElementById('diary-entries');
            const addDiaryBtn = document.getElementById('add-diary');
            const saveDiariesBtn = document.getElementById('save-diaries');
            
            // åˆå§‹æ—¥è®°æ•°æ®ï¼ˆå¯ä»æœ¬åœ°å­˜å‚¨åŠ è½½ï¼‰
            let diaries = JSON.parse(localStorage.getItem('loveDiaries')) || [
                {
                    date: '2025-06-09',
                    content: 'ä»Šå¤©æ˜¯å‘¨ä¸€ï¼Œå‰ä¸¤å¤©çªå‘å¥‡æƒ³ï¼ˆå¤§æ¦‚æ˜¯3å·ï¼‰ï¼Œæƒ³ç»™æˆ‘ä»¬åšä¸€ä¸ªç½‘ç«™ï¼ˆå…¶å®ä¹Ÿä¸æ˜¯çªå‘å¥‡æƒ³ï¼Œæˆ‘ä¹‹å‰å°±æœ‰æƒ³åˆ°è¿‡ï¼Œç”¨ç‹¬ç‰¹çš„æ–¹å¼è®°å½•ä¸€ä¸‹æˆ‘ä»¬ï¼‰é‚£ä¸ºä»€ä¹ˆæ˜¯ä»Šå¤©æ‰å¼€å§‹æœ‰æ—¥è®°å‘¢ï¼Œé‚£æ˜¯å› ä¸ºä»Šå¤©æ‰æŠŠç½‘ç«™çš„æ¡†æ¶æ­å¥½å˜»å˜»å˜»'
                },
                {
                    date: '2025-06-10',
                    content: 'ä»Šå¤©æ˜¯å‘¨äºŒï¼Œæˆ‘ä»¬ä»Šå¤©è€ƒè¯•äº†ï¼Œå˜»å˜»å˜»å˜»å˜»æœ‰ç‚¹æ²¡äº²å¤Ÿï¼Œè¿˜æƒ³äº²äº²~ï¼Œå’±ä»¬ä»Šå¤©è¿˜è¯´é©¬ä¸Šä¸€å‘¨å¹´ï¼Œæˆ‘ä»¬è¯¥å’‹è¿‡å‘€ï¼Œæˆ‘ä¹Ÿåœ¨æ€è€ƒï¼Œå˜¤å˜¤å˜¤ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“å’‹è¿‡ï¼Œéƒ½ä¸çŸ¥é“èƒ½ä¸èƒ½è§é¢å˜'
                },
                
            ];
            
            // æ¸²æŸ“æ—¥è®°åˆ—è¡¨
            function renderDiaries() {
                diaryEntries.innerHTML = '';
                
                if (diaries.length === 0) {
                    diaryEntries.innerHTML = '<p>è¿˜æ²¡æœ‰æ—¥è®°è®°å½•å“¦ï¼Œç‚¹å‡»"æ·»åŠ æ–°æ—¥è®°"æŒ‰é’®å¼€å§‹è®°å½•å§~</p>';
                    return;
                }
                
                diaries.forEach((diary, index) => {
                    const entryElement = document.createElement('div');
                    entryElement.className = 'diary-entry';
                    entryElement.innerHTML = `
                        <div class="delete-diary" data-index="${index}">âŒ</div>
                        <div class="diary-date">${formatDate(diary.date)}</div>
                        <div class="diary-content">${diary.content}</div>
                    `;
                    diaryEntries.appendChild(entryElement);
                });
                
                // æ·»åŠ åˆ é™¤æŒ‰é’®äº‹ä»¶
                document.querySelectorAll('.delete-diary').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const index = parseInt(e.target.getAttribute('data-index'));
                        deleteDiary(index);
                    });
                });
            }
            
            // åˆ é™¤æ—¥è®°
            function deleteDiary(index) {
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ—¥è®°å—ï¼Ÿ')) {
                    diaries.splice(index, 1);
                    saveDiariesToLocalStorage();
                    renderDiaries();
                }
            }
            
            // æ ¼å¼åŒ–æ—¥æœŸ
            function formatDate(dateString) {
                const date = new Date(dateString);
                const year = date.getFullYear();
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const day = date.getDate().toString().padStart(2, '0');
                const weekMap = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
                const weekDay = weekMap[date.getDay()];
                return `${year}å¹´${month}æœˆ${day}æ—¥ ${weekDay}`;
            }
            
            // æ‰“å¼€æ—¥è®°å¼¹çª—
            openDiaryBtn.addEventListener('click', () => {
                renderDiaries();
                diaryModal.style.display = 'flex';
                document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
            });
            
            // å…³é—­æ—¥è®°å¼¹çª—
            function closeDiaryModal() {
                diaryModal.style.display = 'none';
                document.body.style.overflow = ''; // æ¢å¤èƒŒæ™¯æ»šåŠ¨
            }
            
            closeModal.addEventListener('click', closeDiaryModal);
            
            // ç‚¹å‡»å¼¹çª—èƒŒæ™¯å…³é—­
            diaryModal.addEventListener('click', (e) => {
                if (e.target === diaryModal) {
                    closeDiaryModal();
                }
            });
            
            // æ·»åŠ æ–°æ—¥è®°
            let newDiaryActive = false;
            addDiaryBtn.addEventListener('click', () => {
                if (newDiaryActive) {
                    // å·²æœ‰æ–°å»ºæ—¥è®°è¡¨å•ï¼Œæäº¤å½“å‰è¡¨å•
                    saveCurrentDiary();
                } else {
                    // åˆ›å»ºæ–°å»ºæ—¥è®°è¡¨å•
                    const today = new Date();
                    const year = today.getFullYear();
                    const month = (today.getMonth() + 1).toString().padStart(2, '0');
                    const day = today.getDate().toString().padStart(2, '0');
                    const newDiaryDate = `${year}-${month}-${day}`;
                    
                    const newDiaryForm = document.createElement('div');
                    newDiaryForm.className = 'new-diary';
                    newDiaryForm.innerHTML = `
                        <div class="diary-date">${formatDate(newDiaryDate)}</div>
                        <textarea placeholder="å†™ä¸‹ä»Šå¤©çš„æ•…äº‹..."></textarea>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button id="save-new-diary">ä¿å­˜æ—¥è®°</button>
                            <button id="cancel-new-diary">å–æ¶ˆ</button>
                        </div>
                    `;
                    diaryEntries.appendChild(newDiaryForm);
                    
                    newDiaryActive = true;
                    
                    // æ·»åŠ ä¿å­˜å’Œå–æ¶ˆæŒ‰é’®äº‹ä»¶
                    document.getElementById('save-new-diary').addEventListener('click', saveCurrentDiary);
                    document.getElementById('cancel-new-diary').addEventListener('click', () => {
                        newDiaryActive = false;
                        diaryEntries.removeChild(newDiaryForm);
                    });
                }
            });
            
            // ä¿å­˜å½“å‰æ–°å»ºçš„æ—¥è®°
            function saveCurrentDiary() {
                const textarea = document.querySelector('.new-diary textarea');
                if (!textarea) return;
                
                const content = textarea.value.trim();
                if (content === '') {
                    alert('æ—¥è®°å†…å®¹ä¸èƒ½ä¸ºç©º');
                    return;
                }
                
                const dateElement = document.querySelector('.new-diary .diary-date');
                const dateText = dateElement.textContent;
                const dateMatch = dateText.match(/(\d{4})å¹´(\d{2})æœˆ(\d{2})æ—¥/);
                if (!dateMatch) return;
                
                const date = `${dateMatch[1]}-${dateMatch[2]}-${dateMatch[3]}`;
                
                // æ·»åŠ åˆ°æ—¥è®°æ•°ç»„
                diaries.push({
                    date: date,
                    content: content
                });
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                saveDiariesToLocalStorage();
                
                // é‡æ–°æ¸²æŸ“æ—¥è®°åˆ—è¡¨
                renderDiaries();
                newDiaryActive = false;
            }
            
            // ä¿å­˜æ—¥è®°åˆ°æœ¬åœ°å­˜å‚¨
            function saveDiariesToLocalStorage() {
                localStorage.setItem('loveDiaries', JSON.stringify(diaries));
                saveDiariesBtn.innerHTML = 'ä¿å­˜æˆåŠŸ âœ”';
                
                // æ¢å¤æŒ‰é’®æ–‡æœ¬
                setTimeout(() => {
                    saveDiariesBtn.innerHTML = 'ä¿å­˜æ—¥è®°';
                }, 2000);
            }
            
            // ä¿å­˜æ—¥è®°æŒ‰é’®
            saveDiariesBtn.addEventListener('click', saveDiariesToLocalStorage);
        }

        // ----------------- åˆå§‹åŒ–å‡½æ•° -----------------
        function init() {
            // åŠ è½½éŸ³ä¹
            const audio = document.getElementById('backgroundMusic');
            audio.src = CONFIG.musicUrl;
            
            // è®¾ç½®èƒŒæ™¯åˆ‡æ¢æŒ‰é’®
            document.getElementById('bg-toggle').addEventListener('click', toggleMediaPlayer);
            
            // è®¾ç½®è§†é¢‘æ§åˆ¶æŒ‰é’®
            document.getElementById('video-control').addEventListener('click', playNextMedia);
            
            // è®¾ç½®éŸ³ä¹æ§åˆ¶
            setupMusicControl();

            // è®¾ç½®æ—¥è®°åŠŸèƒ½
            setupDiaryFunctionality();

            // å®æ—¶æ›´æ–°æ‹çˆ±æ—¶é•¿
            updateLoveDays();
            setInterval(updateLoveDays, 60000);
            
            // å¦‚æœæœ‰åª’ä½“åˆ—è¡¨ï¼Œå¼€å§‹æ’­æ”¾
            if (CONFIG.mediaList.length > 0) {
                isPlaying = true;
                loadMedia(CONFIG.mediaList[mediaIndex]);
            }
        }

        // é¡µé¢åŠ è½½åè¿è¡Œ
        window.onload = init;
    </script>
</body>
</html>    